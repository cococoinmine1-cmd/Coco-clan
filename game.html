<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Coco Clan - Multiplayer Strategy</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap');
        body { margin: 0; background: #1a1a1a; overflow: hidden; font-family: 'Poppins', sans-serif; color: white; user-select: none; }
        canvas { display: block; background: #2d5a27; cursor: crosshair; }
        
        #ui-layer { position: fixed; top: 0; left: 0; width: 100%; pointer-events: none; z-index: 10; }
        .top-bar { display: flex; justify-content: space-around; background: rgba(0,0,0,0.85); padding: 10px; pointer-events: all; border-bottom: 3px solid #f1c40f; }
        .resource { font-weight: bold; color: #f1c40f; font-size: 14px; }
        
        .action-menu { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); 
                      display: flex; gap: 10px; background: rgba(0,0,0,0.9); padding: 12px; 
                      border-radius: 25px; border: 2px solid #f1c40f; pointer-events: all; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        
        .menu-item { text-align: center; cursor: pointer; transition: 0.2s; padding: 8px; border-radius: 15px; width: 65px; background: #333; }
        .menu-item:hover { background: #444; border: 1px solid #f1c40f; }
        .menu-item img { width: 35px; height: 35px; }
        .menu-item span { display: block; font-size: 9px; margin-top: 4px; font-weight: bold; color: #ccc; }

        #status-msg { position: fixed; top: 75px; width: 100%; text-align: center; color: #fff; background: rgba(0,0,0,0.5); padding: 5px 0; font-size: 13px; }
        .btn-active { background: #f1c40f !important; color: #000 !important; }
        .btn-active span { color: #000 !important; }

        /* Victory Overlay */
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); 
                    flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
        #overlay h2 { font-size: 50px; color: #f1c40f; margin: 0; }
    </style>
</head>
<body>

<div id="overlay">
    <h2>VICTORY!</h2>
    <p>Enemy Base Destroyed</p>
    <button onclick="location.reload()" style="padding: 10px 20px; cursor: pointer; background: #f1c40f; border: none; border-radius: 5px; font-weight: bold;">Next Level</button>
</div>

<div id="ui-layer">
    <div class="top-bar">
        <div class="resource">ü•• Coco: <span id="res-coco">1000</span></div>
        <div class="resource">‚öîÔ∏è Troops: <span id="res-troops">0</span></div>
        <div class="resource">üö© Enemy Buildings: <span id="res-enemy">0</span></div>
    </div>
    <div id="status-msg">COMMANDER: Build your defense or Attack the enemy camp!</div>
</div>

<div class="action-menu">
    <div class="menu-item" id="btn-mine" onclick="setMode('build', 'mine', 150)">
        <img src="https://cdn-icons-png.flaticon.com/512/1239/1239608.png" alt="Mine">
        <span>Mine (150)</span>
    </div>
    <div class="menu-item" id="btn-barracks" onclick="setMode('build', 'barracks', 300)">
        <img src="https://cdn-icons-png.flaticon.com/512/619/619153.png" alt="Barracks">
        <span>Barracks (300)</span>
    </div>
    <div class="menu-item" onclick="trainTroop(100)">
        <img src="https://cdn-icons-png.flaticon.com/512/3534/3534069.png" alt="Train">
        <span>Train (100)</span>
    </div>
    <div class="menu-item" id="btn-deploy" onclick="setMode('attack', 'soldier', 0)">
        <img src="https://cdn-icons-png.flaticon.com/512/2563/2563030.png" alt="Attack">
        <span>Deploy</span>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let resources = { coco: 1000, troops: 0 };
    let buildings = [];
    let troops = [];
    let currentMode = null;
    let selectedSubtype = null;
    let selectedCost = 0;

    class Building {
        constructor(x, y, type, isEnemy = false) {
            this.x = x; this.y = y; this.type = type; this.isEnemy = isEnemy;
            this.size = 60; this.hp = isEnemy ? 200 : 100; this.maxHp = this.hp;
        }
        draw() {
            ctx.fillStyle = "rgba(0,0,0,0.3)"; ctx.fillRect(this.x - 25, this.y + 25, 60, 10); // Shadow
            ctx.fillStyle = "#ff4757"; ctx.fillRect(this.x - 30, this.y - 45, 60, 5); // HP BG
            ctx.fillStyle = "#2ed573"; ctx.fillRect(this.x - 30, this.y - 45, (this.hp/this.maxHp)*60, 5); // HP
            
            ctx.fillStyle = this.isEnemy ? '#c0392b' : (this.type === 'mine' ? '#f1c40f' : '#2980b9');
            ctx.fillRect(this.x - 30, this.y - 30, 60, 60);
            
            ctx.fillStyle = "#fff"; ctx.font = "bold 10px Arial";
            ctx.fillText(this.isEnemy ? "ENEMY HQ" : this.type.toUpperCase(), this.x - 25, this.y + 5);
        }
    }

    class Troop {
        constructor(x, y) {
            this.x = x; this.y = y; this.speed = 1.2;
            this.damage = 0.8; this.target = null;
        }
        update() {
            let enemies = buildings.filter(b => b.isEnemy);
            if (enemies.length > 0) {
                this.target = enemies[0];
                let minDist = Math.hypot(this.x - this.target.x, this.y - this.target.y);
                enemies.forEach(b => {
                    let d = Math.hypot(this.x - b.x, this.y - b.y);
                    if (d < minDist) { minDist = d; this.target = b; }
                });

                let angle = Math.atan2(this.target.y - this.y, this.target.x - this.x);
                if (minDist > 40) {
                    this.x += Math.cos(angle) * this.speed;
                    this.y += Math.sin(angle) * this.speed;
                } else { this.target.hp -= this.damage; }
            }
        }
        draw() {
            ctx.fillStyle = "#fff"; ctx.beginPath(); ctx.arc(this.x, this.y, 9, 0, Math.PI*2); ctx.fill(); // Body
            ctx.fillStyle = "#3498db"; ctx.beginPath(); ctx.arc(this.x, this.y, 5, 0, Math.PI*2); ctx.fill(); // Armor
        }
    }

    // Spawn Enemy Base
    function initEnemy() {
        buildings.push(new Building(canvas.width - 150, 150, 'hq', true));
        buildings.push(new Building(canvas.width - 150, 300, 'hq', true));
        buildings.push(new Building(canvas.width - 300, 225, 'hq', true));
    }

    function setMode(mode, subtype, cost) {
        currentMode = mode; selectedSubtype = subtype; selectedCost = cost;
        document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('btn-active'));
        if (mode === 'build') document.getElementById('btn-' + subtype).classList.add('btn-active');
        if (mode === 'attack') document.getElementById('btn-deploy').classList.add('btn-active');
    }

    function trainTroop(cost) {
        if (resources.coco >= cost) {
            resources.coco -= cost; resources.troops++;
        }
    }

    canvas.addEventListener('click', (e) => {
        if (currentMode === 'build' && resources.coco >= selectedCost) {
            buildings.push(new Building(e.clientX, e.clientY, selectedSubtype, false));
            resources.coco -= selectedCost;
        } else if (currentMode === 'attack' && resources.troops > 0) {
            troops.push(new Troop(e.clientX, e.clientY));
            resources.troops--;
        }
    });

    function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Grid
        ctx.strokeStyle = "rgba(255,255,255,0.03)";
        for(let i=0; i<canvas.width; i+=50) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); ctx.stroke(); }

        buildings = buildings.filter(b => b.hp > 0);
        let enemyCount = 0;
        buildings.forEach(b => {
            b.draw();
            if (!b.isEnemy && b.type === 'mine') resources.coco += 0.08;
            if (b.isEnemy) enemyCount++;
        });

        document.getElementById('res-enemy').innerText = enemyCount;
        if (enemyCount === 0) document.getElementById('overlay').style.display = "flex";

        troops.forEach(t => { t.update(); t.draw(); });
        
        document.getElementById('res-coco').innerText = Math.floor(resources.coco);
        document.getElementById('res-troops').innerText = resources.troops;
        requestAnimationFrame(gameLoop);
    }

    initEnemy();
    gameLoop();
</script>
</body>
</html>
